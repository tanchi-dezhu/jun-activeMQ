# ActiveMQ

## 点对点

生产者发布消息到队列，消费者从队列获取消息，队列的存在使异步成为可能。

- 如果有Session关闭时有部分消息被收到但没有被签收（acknowledged），那当消费者下次连接时到相同队列时，消息还是会被再次消费。
- 队列可以长久的保持消息知道消费者消费消息。消费者可以不用担心消息丢失而时刻保持和队列的激活状态。**充分体现了异步传输的优点。**

## JMS Pub/Sub 模型

定义了如何向一个内容节点发布和订阅消息，这些节点被称作topic

主题可以被认为是消息的传输中介，发布者（publisher）发布消息到主题，订阅者（subscribe）从主题订阅消息。

主题使得消息订阅者和消息发布者保持互相独立不需要解除即可保证消息的传送。

### 非持久化订阅

只有当客户端处于订阅状态的时候，才能收到发布到某个主题的消息。

**先订阅注册才能接收发布，只给订阅者发布消息。**

### 持久化订阅

客户端首先向MQ注册一个自己的身份ID识别号，当这个客户端处于离线时，生产者会为这个ID保存所有发送到主题的消息，当客户再次连接到MQ的时候，会根据消费者的ID得到所有当自己处于离线时发送到主题的消息。

非持久状态下，不能恢复或重新派送一个未签收的消息。

持久状态下，才能恢复或重新派送一个未签收的消息。

## MQ的高可用

1. 事务
2. 持久
3. 签收
4. 可持久化